<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUSSON - Rubores</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <nav class="navbar">
        <div class="nav-left">
            <i class="fa-solid fa-bars menu-icon" onclick="toggleMenu(true)"></i>
            <a href="index.html" class="logo">LUSSON</a>
        </div>
        <div class="cart-icon" onclick="toggleCart(true)">
            <i class="fa-solid fa-bag-shopping"></i>
            <span id="cart-count">0</span>
        </div>
    </nav>

    <div id="nav-menu" class="nav-menu">
        <div class="menu-header">
            <h2>Menú</h2>
            <i class="fa-solid fa-xmark" style="cursor: pointer;" onclick="toggleMenu(false)"></i>
        </div>
        <ul class="menu-links">
            <li><a href="index.html">Inicio</a></li>
            <li><a href="rubores.html" class="active">Rubores</a></li>
            <li><a href="labiales.html">Labiales</a></li>
            <li><a href="polvos.html">Polvos</a></li>
            <li><a href="bases.html">Bases y Correctores</a></li>
        </ul>
    </div>

    <main id="grid-productos" class="grid-productos">
        <p style="grid-column: 1/-1; text-align: center; padding: 20px;">Cargando colección...</p>
    </main>

    <div id="cart-panel" class="cart-panel">
        <div class="cart-header">
            <h2>Mi Bolsa</h2>
            <i class="fa-solid fa-xmark" style="cursor: pointer;" onclick="toggleCart(false)"></i>
        </div>
        <div id="cart-items" class="cart-items">
            </div>
        <div class="cart-footer">
            <div style="display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: bold;">
                <span>Total:</span>
                <span>$<span id="cart-total-price">0</span></span>
            </div>
            <button class="btn-checkout" onclick="finalizarPedido()">Finalizar por WhatsApp <i class="fa-brands fa-whatsapp"></i></button>
        </div>
    </div>

    <a href="https://wa.me/TUNUMERO_WHATSAPP" class="whatsapp-btn" target="_blank" title="Escríbenos">
        <i class="fa-brands fa-whatsapp"></i>
    </a>

    <footer class="footer">
        <p>© 2026 LUSSON COLOMBIA - Alta Cosmética</p>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        // 1. CONFIGURACIÓN DE FIREBASE (PEGA TUS LLAVES AQUÍ)
        const firebaseConfig = {
            apiKey: "PEGA_AQUÍ_TU_API_KEY_DE_LA_IMAGEN_1000059140.JPG",
            authDomain: "lusson-web.firebaseapp.com",
            projectId: "lusson-web",
            storageBucket: "lusson-web.firebasestorage.app",
            messagingSenderId: "445073966036",
            appId: "1:445073966036:web:f6c56d465f68ace86a4c41"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 2. LÓGICA DE LA PÁGINA Y EL CARRITO
        let carrito = [];
        const grid = document.getElementById('grid-productos');

        // Función para cargar productos desde Firebase (colección 'lusso')
        function cargarProductos() {
            db.collection("lusso").onSnapshot((snapshot) => {
                grid.innerHTML = ''; // Limpiar cuadrícula
                snapshot.forEach((doc) => {
                    const p = doc.data();
                    // Crear tarjeta de producto ordenada
                    grid.innerHTML += `
                        <div class="producto-card">
                            <img src="${p.img}" alt="${p.nombre}">
                            <div>
                                <h3 style="font-size: 14px;">${p.nombre}</h3>
                                <p style="color: #d4af37; font-weight: bold;">$${p.precio}</p>
                            </div>
                            <button class="btn-agregar" onclick="agregarAlCarrito('${p.nombre}', ${p.precio}, '${p.img}')">
                                AGREGAR <i class="fa-solid fa-cart-plus"></i>
                            </button>
                        </div>
                    `;
                });
            });
        }

        // Función para agregar productos a la bolsa
        function agregarAlCarrito(nombre, precio, img) {
            carrito.push({nombre, precio, img});
            actualizarCarrito();
        }

        // Función para eliminar productos de la bolsa
        function eliminarDelCarrito(index) {
            carrito.splice(index, 1);
            actualizarCarrito();
        }

        // Función para actualizar visualmente el carrito
        function actualizarCarrito() {
            const itemsContainer = document.getElementById('cart-items');
            const totalContainer = document.getElementById('cart-total-price');
            const countContainer = document.getElementById('cart-count');
            
            itemsContainer.innerHTML = '';
            let total = 0;

            carrito.forEach((prod, index) => {
                total += prod.precio;
                // Crear ítem de carrito con miniatura
                itemsContainer.innerHTML += `
                    <div class="cart-item">
                        <img src="${prod.img}" alt="${prod.nombre}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">
                        <div style="flex: 1;">
                            <h4 style="font-size: 14px; font-weight: normal;">${prod.nombre}</h4>
                            <p style="color: #d4af37; font-weight: bold; font-size: 13px;">$${prod.precio}</p>
                        </div>
                        <i class="fa-solid fa-trash btn-eliminar" style="color: #ff4d4d; cursor: pointer;" onclick="eliminarDelCarrito(${index})"></i>
                    </div>
                `;
            });

            totalContainer.innerText = total.toLocaleString('es-CO'); // Formato de precio colombiano
            countContainer.innerText = carrito.length;
        }

        // Función para abrir/cerrar el panel del menú deslizable
        function toggleMenu(abrir) {
            const panel = document.getElementById('nav-menu');
            if(abrir) panel.classList.add('open');
            else panel.classList.remove('open');
        }

        // Función para abrir/cerrar el panel del carrito (Efecto deslizable)
        function toggleCart(abrir) {
            const panel = document.getElementById('cart-panel');
            if(abrir) panel.classList.add('open');
            else panel.classList.remove('open');
        }

        // Función para enviar el pedido por WhatsApp
        function finalizarPedido() {
            if (carrito.length === 0) {
                alert("Tu bolsa está vacía.");
                return;
            }
            
            let mensaje = "Hola LUSSON! Me gustaría hacer un pedido:\n\n";
            let total = 0;
            
            carrito.forEach((prod, index) => {
                mensaje += `${index + 1}. ${prod.nombre} - $${prod.precio.toLocaleString('es-CO')}\n`;
                total += prod.precio;
            });
            
            mensaje += `\n*Total:* $${total.toLocaleString('es-CO')}\n`;
            mensaje += "\n¿Cuál es el siguiente paso?";
            
            const numeroWhatsApp = "57TUNUMERO_AQUI"; 
            const url = `https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(mensaje)}`;
            window.open(url, '_blank');
        }

        // --- CERRAR AL TOCAR FUERA ---
        // Escuchamos los clics en todo el documento
        document.addEventListener('click', function(event) {
            const navMenu = document.getElementById('nav-menu');
            const cartPanel = document.getElementById('cart-panel');
            const menuIcon = document.querySelector('.menu-icon');
            const cartIcon = document.querySelector('.cart-icon');

            // Si el menú está abierto y tocamos fuera de él y de su icono, lo cerramos
            if (navMenu.classList.contains('open') && 
                !navMenu.contains(event.target) && 
                !menuIcon.contains(event.target)) {
                toggleMenu(false);
            }

            // Si el carrito está abierto y tocamos fuera de él y de su icono, lo cerramos
            if (cartPanel.classList.contains('open') && 
                !cartPanel.contains(event.target) && 
                !cartIcon.contains(event.target)) {
                toggleCart(false);
            }
        });

        // Iniciar la carga de productos
        cargarProductos();
    </script>
</body>
</html>

