<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lusson | Tienda Oficial</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,700&family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root { --nude-bg: #f5eee6; --oro: #bca07d; --negro: #1a1a1a; --blanco: #ffffff; }
        body { margin: 0; font-family: 'Montserrat', sans-serif; background: var(--blanco); color: var(--negro); }
        
        header { background: var(--nude-bg); padding: 20px; text-align: center; position: relative; border-bottom: 1px solid #ddd; }
        .logo { font-family: 'Playfair Display', serif; font-size: 1.8rem; letter-spacing: 5px; text-decoration: none; color: var(--negro); }
        .nav-enlaces { display: flex; justify-content: center; gap: 20px; margin-top: 10px; }
        .link-nav { text-decoration: none; color: var(--negro); font-size: 0.7rem; font-weight: bold; text-transform: uppercase; }

        /* Carrito Flotante */
        .bolsa-flotante { position: fixed; top: 20px; right: 20px; background: var(--negro); color: white; width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .contador { position: absolute; top: 0; right: 0; background: var(--oro); color: white; font-size: 0.7rem; padding: 2px 6px; border-radius: 50%; }

        /* Dise√±o del Cat√°logo */
        .grid-productos { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .producto { text-align: center; border: 1px solid #eee; padding: 12px; background: white; border-radius: 8px; transition: 0.3s; }
        .producto img { width: 100%; height: 200px; object-fit: cover; border-radius: 4px; cursor: pointer; }
        .btn-add { background: var(--negro); color: white; border: none; padding: 10px; width: 100%; cursor: pointer; font-size: 0.8rem; margin-top: 10px; font-weight: bold; }

        /* Estilos del Carrito Detalle */
        #carrito-detalle { position: fixed; top: 85px; right: 20px; background: white; width: 320px; max-width: 90%; border: 1px solid #ddd; padding: 20px; display: none; z-index: 1000; box-shadow: 0 10px 40px rgba(0,0,0,0.2); border-radius: 8px; }
        .item-linea { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 0.8rem; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .btn-eliminar { color: #ff4d4d; cursor: pointer; font-weight: bold; background: none; border: none; }
        
        .admin-active .producto { border: 2px dashed var(--oro); }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="logo">LUSSON</a>
        <div class="nav-enlaces">
            <a href="index.html" class="link-nav">‚Üê INICIO</a>
            <a href="#" class="link-nav" style="color:var(--oro)">LABIALES</a>
        </div>
    </header>

    <div class="bolsa-flotante" onclick="toggleCarrito()">
        üõçÔ∏è <span id="cant-total" class="contador">0</span>
    </div>

    <div id="carrito-detalle">
        <h3 style="margin-top:0">Mi Bolsa Lusson</h3>
        <div id="lista-items"></div>
        <div style="border-top: 2px solid var(--nude-bg); margin-top:15px; padding-top:10px; font-weight:bold;">
            TOTAL: $<span id="total-dinero">0</span>
        </div>
        <button class="btn-add" style="background:#25d366" onclick="comprarWhatsApp()">PEDIR POR WHATSAPP</button>
        <button class="btn-add" onclick="toggleCarrito()">CERRAR</button>
    </div>

    <main>
        <div id="contenedor-tienda" class="grid-productos"></div>
    </main>

    <div onclick="conteoJefa()" style="width: 20px; height: 20px; background: transparent; margin: 40px auto; cursor: default;"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // --- CONFIGURACI√ìN SUPABASE ---
        const supabaseUrl = 'https://azfingejfhjmbkcrtlbb.supabase.co'; 
        const supabaseKey = 'sb_publishable_oEmSiQhpAZ9HToa9C2nHXg_5qHIZDUD';
        const supabase = supabase.createClient(https://azfingejfhjmbkcrtlbb.supabase.co , sb_publishable_oEmSiQhpAZ9HToa9C2nHXg_5qHIZDUD);

        let carrito = [];
        let clicsJefa = 0;

        // --- CARGAR PRODUCTOS ---
        async function cargarProductosDesdeBD() {
            const { data: productos, error } = await supabase.from('productos').select('*');
            if (error) return console.error(error);

            const tienda = document.getElementById('contenedor-tienda');
            tienda.innerHTML = '';

            productos.forEach(prod => {
                tienda.innerHTML += `
                    <div class="producto">
                        <img src="${prod.Imagen}" onclick="accionImagen(${prod.id})">
                        <h3 onclick="if(esJefa()) editarNombre(${prod.id})">${prod.nombre}</h3>
                        <p style="color:var(--oro); font-weight:bold;" onclick="if(esJefa()) actualizarPrecio(${prod.id})">
                            $${prod.precio.toLocaleString()} ‚úèÔ∏è
                        </p>
                        <button class="btn-add" onclick="agregar('${prod.nombre}', ${prod.precio})">AGREGAR</button>
                    </div>`;
            });
        }

        // --- FUNCIONES CARRITO ---
        function agregar(nombre, precio) {
            const item = carrito.find(i => i.nombre === nombre);
            item ? item.cantidad++ : carrito.push({ nombre, precio, cantidad: 1 });
            actualizarUI();
        }

        function actualizarUI() {
            const lista = document.getElementById('lista-items');
            let total = 0, unidades = 0;
            lista.innerHTML = '';
            
            carrito.forEach((item, index) => {
                const subtotal = item.precio * item.cantidad;
                total += subtotal;
                unidades += item.cantidad;
                lista.innerHTML += `
                    <div class="item-linea">
                        <span>${item.nombre} (x${item.cantidad})</span>
                        <span>$${subtotal.toLocaleString()} <button class="btn-eliminar" onclick="eliminar(${index})">X</button></span>
                    </div>`;
            });
            document.getElementById('total-dinero').innerText = total.toLocaleString();
            document.getElementById('cant-total').innerText = unidades;
        }

        function eliminar(index) { carrito.splice(index, 1); actualizarUI(); }
        function toggleCarrito() { const c = document.getElementById('carrito-detalle'); c.style.display = c.style.display === 'block' ? 'none' : 'block'; }

        function comprarWhatsApp() {
            let mensaje = "¬°Hola Lusson! Mi pedido es:\n";
            carrito.forEach(i => mensaje += `- ${i.nombre} x${i.cantidad}\n`);
            mensaje += `Total: $${document.getElementById('total-dinero').innerText}`;
            window.open(`https://wa.me/573000000000?text=${encodeURIComponent(mensaje)}`);
        }

        // --- MODO JEFA (EDITABLE) ---
        function esJefa() { return document.body.classList.contains('admin-active'); }

        function conteoJefa() {
            clicsJefa++;
            if (clicsJefa === 5) {
                const user = prompt("Usuario de Lusson:");
                const pass = prompt("Contrase√±a:");
                if (user === "lusso2026" && pass === "11209") {
                    document.body.classList.add('admin-active');
                    alert("¬°Bienvenida Jefa! Modo edici√≥n activado.");
                }
                clicsJefa = 0;
            }
        }

        async function actualizarPrecio(id) {
            const nuevo = prompt("¬øNuevo precio?");
            if (nuevo) {
                await supabase.from('productos').update({ precio: parseInt(nuevo) }).eq('id', id);
                location.reload();
            }
        }

        function accionImagen(id) {
            if (esJefa()) {
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.onchange = async (e) => {
                    const file = e.target.files[0];
                    const nombreImg = `prod_${Date.now()}.png`;
                    const { data } = await supabase.storage.from('fotos-lusson').upload(nombreImg, file);
                    if (data) {
                        const { data: urlData } = supabase.storage.from('fotos-lusson').getPublicUrl(nombreImg);
                        await supabase.from('productos').update({ Imagen: urlData.publicUrl }).eq('id', id);
                        location.reload();
                    }
                };
                fileInput.click();
            } else {
                window.location.href = `producto.html?id=${id}`;
            }
        }

        cargarProductosDesdeBD();
    </script>
</body>
</html>
