<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin LUSSON | Gesti√≥n Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --pink-cute: #ffdeeb; --pink-accent: #f8bbd0; --negro: #1a1a1a; }
        body { font-family: 'Montserrat', sans-serif; background: #fdfaf5; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        .hidden { display: none; }
        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid var(--pink-cute); border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 14px; background: var(--negro); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn-pink { background: var(--pink-accent); color: white; margin-bottom: 20px; }
        .section-card { background: #fffafa; padding: 20px; border: 1px solid var(--pink-cute); border-radius: 12px; margin-bottom: 30px; }
        .item-list { display: flex; align-items: center; justify-content: space-between; padding: 10px; border-bottom: 1px solid var(--pink-cute); }
        .item-list img { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; }
        .grid-imgs { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-edit { background: #e3f2fd; color: #1976d2; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-right: 5px; }
    </style>
</head>
<body>

    <div id="login-section" class="container">
        <h2 style="text-align:center;">Acceso Privado LUSSON</h2>
        <input type="email" id="email" placeholder="Correo">
        <input type="password" id="password" placeholder="Contrase√±a">
        <button onclick="login()">INGRESAR</button>
    </div>

    <div id="admin-section" class="container hidden">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2>Panel LUSSON</h2>
            <button onclick="logout()" style="width:auto; background:#757575;">Salir</button>
        </div>

        <div class="section-card">
            <h3>üñºÔ∏è Im√°genes de Inicio</h3>
            <select id="tipo-inicio">
                <option value="banners">A√±adir al Carrusel (Banner)</option>
                <option value="combos">Cambiar Imagen de Combos</option>
                <option value="promos">Cambiar Imagen de Promociones</option>
            </select>
            <input type="text" id="url-inicio" placeholder="URL de la Imagen (Postimg)">
            <button class="btn-pink" onclick="actualizarInicio()">ACTUALIZAR INICIO</button>
        </div>

        <div class="section-card">
            <h3 id="form-titulo">üíÑ Agregar Nuevo Producto</h3>
            <button class="btn-pink" id="btn-toggle-form" onclick="toggleForm()">+ MOSTRAR FORMULARIO</button>
            
            <div id="form-prod" class="hidden">
                <input type="hidden" id="edit-id"> <input type="text" id="p-nombre" placeholder="Nombre del Producto">
                
                <div class="grid-imgs">
                    <input type="number" id="p-precio" placeholder="Precio">
                    <input type="number" id="p-stock" placeholder="Cantidad en Stock">
                </div>
                
                <p style="font-size: 0.8rem; margin: 10px 0 5px; font-weight: bold;">Galer√≠a (5 fotos):</p>
                <input type="text" id="p-img1" placeholder="Foto 1 (Principal)">
                <div class="grid-imgs">
                    <input type="text" id="p-img2" placeholder="Foto 2">
                    <input type="text" id="p-img3" placeholder="Foto 3">
                    <input type="text" id="p-img4" placeholder="Foto 4">
                    <input type="text" id="p-img5" placeholder="Foto 5">
                </div>

                <input type="text" id="p-tonos" placeholder="Tonos (Rojo, Rosa, Nude...)">
                <textarea id="p-desc" placeholder="Descripci√≥n completa" style="height:80px;"></textarea>
                <textarea id="p-specs" placeholder="Especificaciones (puntos)" style="height:80px;"></textarea>
                
                <select id="p-col">
                    <option value="labiales">Labiales</option>
                    <option value="lusso">Rubores (lusso)</option>
                    <option value="bases">Bases y Correctores</option>
                    <option value="polvos">Polvos</option>
                    <option value="skincare">Skincare</option>
                </select>
                <button id="btn-final" onclick="guardarProducto()" style="background:var(--pink-accent); color:black;">GUARDAR EN FIREBASE</button>
                <button onclick="cancelarEdicion()" style="background:#eee; color:#333; margin-top:5px;">CANCELAR</button>
            </div>
        </div>

        <div id="inventario">
            <h3>Inventario Actual</h3>
            <select id="ver-col" onchange="cargarLista()">
                <option value="labiales">Labiales</option>
                <option value="lusso">Rubores (lusso)</option>
                <option value="bases">Bases</option>
                <option value="polvos">Polvos</option>
                <option value="skincare">Skincare</option>
            </select>
            <div id="lista-items"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = { /* Manten tus credenciales actuales */ };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        function login() {
            auth.signInWithEmailAndPassword(document.getElementById('email').value, document.getElementById('password').value)
                .catch(() => alert("Acceso denegado"));
        }

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('admin-section').classList.remove('hidden');
                cargarLista();
            }
        });

        function toggleForm() {
            document.getElementById('form-prod').classList.toggle('hidden');
        }

        // FUNCI√ìN PARA CARGAR DATOS EN EL FORMULARIO (EDITAR)
        function prepararEdicion(id, col) {
            db.collection(col).doc(id).get().then(doc => {
                const p = doc.data();
                document.getElementById('form-prod').classList.remove('hidden');
                document.getElementById('form-titulo').innerText = "‚úçÔ∏è Editando Producto";
                document.getElementById('btn-final').innerText = "ACTUALIZAR CAMBIOS";
                
                document.getElementById('edit-id').value = id;
                document.getElementById('p-nombre').value = p.nombre || '';
                document.getElementById('p-precio').value = p.precio || '';
                document.getElementById('p-stock').value = p.stock || 0;
                document.getElementById('p-img1').value = p.img || '';
                document.getElementById('p-img2').value = p.img2 || '';
                document.getElementById('p-img3').value = p.img3 || '';
                document.getElementById('p-img4').value = p.img4 || '';
                document.getElementById('p-img5').value = p.img5 || '';
                document.getElementById('p-desc').value = p.descripcion || '';
                document.getElementById('p-specs').value = p.especificaciones || '';
                document.getElementById('p-tonos').value = p.tonos || '';
                document.getElementById('p-col').value = col;
                
                window.scrollTo(0, 200);
            });
        }

        function guardarProducto() {
            const id = document.getElementById('edit-id').value;
            const col = document.getElementById('p-col').value;
            const data = {
                nombre: document.getElementById('p-nombre').value,
                precio: Number(document.getElementById('p-precio').value),
                stock: Number(document.getElementById('p-stock').value),
                img: document.getElementById('p-img1').value,
                img2: document.getElementById('p-img2').value,
                img3: document.getElementById('p-img3').value,
                img4: document.getElementById('p-img4').value,
                img5: document.getElementById('p-img5').value,
                descripcion: document.getElementById('p-desc').value,
                especificaciones: document.getElementById('p-specs').value,
                tonos: document.getElementById('p-tonos').value
            };

            if(id) {
                // ACTUALIZAR PRODUCTO EXISTENTE
                db.collection(col).doc(id).update(data).then(() => {
                    alert("¬°Producto actualizado!");
                    cancelarEdicion();
                });
            } else {
                // CREAR NUEVO PRODUCTO
                db.collection(col).add(data).then(() => {
                    alert("¬°Producto creado!");
                    limpiarCampos();
                    document.getElementById('form-prod').classList.add('hidden');
                });
            }
        }

        function cargarLista() {
            const col = document.getElementById('ver-col').value;
            db.collection(col).onSnapshot(snap => {
                const container = document.getElementById('lista-items');
                container.innerHTML = '';
                snap.forEach(doc => {
                    const d = doc.data();
                    container.innerHTML += `
                        <div class="item-list">
                            <img src="${d.img}">
                            <div style="flex:1; margin-left:15px;">
                                <strong>${d.nombre || 'Sin nombre'}</strong><br>
                                <small>Stock: ${d.stock || 0}</small>
                            </div>
                            <button class="btn-edit" onclick="prepararEdicion('${doc.id}', '${col}')">Editar</button>
                            <button onclick="eliminar('${doc.id}', '${col}')" style="width:auto; background:#ff4d4d; padding:5px 10px;">X</button>
                        </div>`;
                });
            });
        }

        function cancelarEdicion() {
            document.getElementById('edit-id').value = '';
            document.getElementById('form-titulo').innerText = "üíÑ Agregar Nuevo Producto";
            document.getElementById('btn-final').innerText = "GUARDAR EN FIREBASE";
            limpiarCampos();
            document.getElementById('form-prod').classList.add('hidden');
        }

        function eliminar(id, col) {
            if(confirm("¬øEliminar?")) db.collection(col).doc(id).delete();
        }

        function limpiarCampos() {
            const ids = ['p-nombre','p-precio','p-stock','p-img1','p-img2','p-img3','p-img4','p-img5','p-desc','p-specs','p-tonos','edit-id'];
            ids.forEach(id => { if(document.getElementById(id)) document.getElementById(id).value = ''; });
        }

        function logout() { auth.signOut(); window.location.reload(); }
    </script>
</body>
</html>
